<!-- TOC -->

- [计算机组成原理](#计算机组成原理)
- [1. 计算机组成原理之机器](#1-计算机组成原理之机器)
  - [1. 计算机系统概论](#1-计算机系统概论)
  - [2. 总线](#2-总线)
  - [3. 存储器](#3-存储器)
    - [1. 主存储器](#1-主存储器)

<!-- /TOC -->
# 计算机组成原理
硬件层面的逻辑实现，与逻辑实现的一般原理。  
基本部件的结构和组织方式，以及基本运算的操作原理，基本部件和单元的设计思想。  
但是可能没学过数字电路等知识，可能学习起来吃力一点。

# 1. 计算机组成原理之机器
## 1. 计算机系统概论
现代计算机由硬件和软件组成。硬件包括计算机实体如主机等，软件就是程序，如系统软件（操作系统）和应用软件。计算机组成主要讲硬件。通常系统通过抽象来管理系统的复杂性（隐藏系统中不重要的细节）。从语言角度是 微指令系统 -> 机器语言 -> 汇编语言 -> 高级语言。 操作系统就是在汇编语言和机器语言之间。现代计算机之父冯诺依曼计算机的基本特点是：
1. 五大部件组成：运算器（ALU）、控制器（CU）、存储器（主存、辅存：需要才加入主存，供cpu用 ）、输入设备和输出设备
2. **指令和数据同等地位都存储在存储器内**，按地址访问：
3. 指令数据都用二进制表示
4. 指令由两部分构成：操作码和地址码：操作码就是指做什么操作（例如加减乘除），地址码指操作数的地址
5. 存储程序
6. 以运算器为中心  

冯诺依曼结构下的计算机中运算器太核心了，改为以存储器为核心的。计算机中算数运算只会加减乘除（牢记）。下面举例说明 ax^2+bx+c的计算过程：
1. 将 a b c都保存在储存器中
2. 取x在运算器中，然后乘以x，存在累加器中（ALU中的一个寄存器），然后继续乘a，继续保存。然后转存到存储器中（ax^2）
3. 同样计算bx ，然后把ax^2 和 c都取到运算器中，依次计算。

也可以优化为(ax+b)x+c,就可以优化指令数目，图中ACC为累加器。  
<img src="photos/指令.png" width="75%">  
数据和指令都存储在存储器中，那么主存储器（就是运行内存，辅存是硬盘）结构如何？
>1. 存储器分为存储体、MAR（存储单元地址，反映存储单元个数（因为都是0 1 2编号），用作临时存储的）和MDR（存储器数据，充当临时储存器，位数反映存储字长）  
>2. 存储体（大楼）里面有存储单元（房间）里面有存储元件（床位）（0/1），存储单元存二进制代码。存储单元有存储字（2进制代码的组合），存储字长就是存储字的位数。每个存储单元有个地址，通过地址访问存储字。  

运算器呢,有ACC（累加器） ALU（算术逻辑单元） MQ（乘除寄存器） 和 X（操作数寄存器）？  （MQ是因为乘法会导致位数扩增，所以要个MQ存放乘积低位）
<img src="photos/运算器.png" width="75%">  
>1. *图中的哪些数放在哪些寄存器里面，我还是有些疑问，这里归结于指令集的问题*，不同指令集有不同的做法。
>2. 操作数不止一个，可以有多个；`MUL R1, R2, 5  // R1 = R2 * 5, R1和R2是寄存器` 如上 R1 R2 和5 都是操作数，操作数可以是数据也可以是数据的地址。
>3. 乘法计算通过不断移位和加法，除法计算是通过不断的减法（13/5 equal to 13-5-5）  

上面的运算器功能都是在控制器下完成的，控制器应该解释指令，并且保证指令的有序进行。
>控制器完成一条指令：1. 控制器从PC（程序计数器）存的地址取指令存到IR，PC自动更新下一条；2. 分析指令，从指令寄存器（IR）取操作码，进行分析。3. 执行指令。（PC 和IR都属于CU）

<img src="photos/总框架.png" width="75%">  

在上图中取指令是从PC -> MAR -> 存储单元 -> MDR -> IR 最后指令就在IR中了。  
计算机硬件指标有：
1. 机器字长：CPU一次能处理数据的位数，跟寄存器位数相关。越长越好，比如现在都做成64位。
2. 运算速度：主频（决定cpu每s执行的时钟周期数）、核数、 FLOPS（每s浮点运算次数）。
3. 储存容量：主存（运行内存）和辅存（硬盘），b是bit B是byte。1K=2^10。操作系统是给每一个字节分配一个地址，所以32位就代表2^32 个地址，所以是4GB，地址也就是32位了，但实际上可表示的比特位是35位。
## 2. 总线
总线是连接各个部件的信息传输线，各部件共享的传输介质。信息传输分为串行（一位位传也一位位接），并行（需要多条数据线，通常传输距离短，因为多线之间互相影响会导致信号变形）。如果只有一条总线，数据传输效率太低（因为总线上有数据在传，其他模块就不能再用）

<img src="photos/总线.png" width="75%">  

按照总线位置，总线分为片内总线（芯片内部）和系统总线：数据总线（双向） 地址总线（单向，cpu往外传） 控制总线（双向）和通信总线（计算机系统之间通信）。总线也有类似的性能指标也有设计标准（便于各配件组装成一个电脑）总线结构有很多，比如有局部总线连接CPU和cache，DMA总线连接主存和I/O接口，这里不过多讲述。主要研究一下总线控制（总线一个时候只能有一个设备使用，且怎么通信）。
>1. 总线有主设备（对总线有控制权）和从设备（响应主设备发送的总线命令）。  
>2. 总线集中式：链式查询（一个个按顺序查看谁发送了总线请求） 计数器定时查询（总线控制部件中有计数器，为0就对I/O接口0查看它有没有发送请求，没有就继续增。优点在于优先级灵活确定：由计数器决定） 独立请求方式：每个接口都有独立的接受请求的线（每个接口两条线：BG0-总线同意 BR0-总线请求，总线控制部件中有排队器来确定优先级） 还有总线分布式。  
>3. 总线通信分为同步（共享统一时钟）、异步通信（没有统一时钟）、半同步（有时钟，但是添加个wait信号，主模块检测到了wait信号低电平，从模块才发送数据）、分离式通信（让总线上基本没空闲时刻，主模块和从模块角色可以转换）

## 3. 存储器
存储器为核心的结构。按照存储介质分类： 半导体存储器、磁表面存储器、磁芯存储器、光盘存储器（半导体和磁）。按照存取方式分类：（1）存取时间与物理地址无关:随机存储器和 只读存储器。（2）存取时间与物理地址有关：磁带 和 磁盘（直接存取存储器：去对应磁盘磁道取值）。按照作用分类：（1）主存储器 RAM 和 ROM （2）flash memory（闪存） 类似于u盘（3）高速缓冲存储器（Cache）（4）辅助存储器：磁盘。

<img src="photos/存储.png" width="75%"> 

<img src="photos/层次.png" width="75%"> 
主存和缓存之间是为了解决速度问题，用硬件来做，主存和辅存之间是为了解决容量问题，用软硬件结合来做。主存储器用到物理地址，主存辅存之间用虚地址（逻辑地址）。（这里有点不太明白....）  

### 1. 主存储器
<img src="photos/主存.png" width="75%"> 
译码通常指的是CPU的控制单元对指令的操作码进行解析的过程。




